"use strict";(self.webpackChunknewdocs=self.webpackChunknewdocs||[]).push([[2441],{37345:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>o,contentTitle:()=>s,default:()=>h,frontMatter:()=>i,metadata:()=>d,toc:()=>c});var a=t(85893),r=t(11151);const i={sidebar_position:13},s="SQL Query API",d={id:"docs/walkthrough/sql_query_API",title:"SQL Query API",description:"Setup",source:"@site/content/docs/walkthrough/13_sql_query_API.md",sourceDirName:"docs/walkthrough",slug:"/docs/walkthrough/sql_query_API",permalink:"/docs/docs/walkthrough/sql_query_API",draft:!1,unlisted:!1,editUrl:"https://github.com/SuperDuperDB/superduperdb/tree/main/docs/content/docs/walkthrough/13_sql_query_API.md",tags:[],version:"current",sidebarPosition:13,frontMatter:{sidebar_position:13},sidebar:"tutorialSidebar",previous:{title:"MongoDB Query API",permalink:"/docs/docs/walkthrough/mongodb_query_API"},next:{title:"Encoding images, audio, video and other special data",permalink:"/docs/docs/walkthrough/encoding_special_data_types"}},o={},c=[{value:"Setup",id:"setup",level:2},{value:"Inserting data",id:"inserting-data",level:2},{value:"Selecting data",id:"selecting-data",level:2},{value:"Vector-search",id:"vector-search",level:3},{value:"Support for raw-sql",id:"support-for-raw-sql",level:3},{value:"Updating data",id:"updating-data",level:2},{value:"Deleting data",id:"deleting-data",level:2}];function l(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",p:"p",pre:"pre",...(0,r.a)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.h1,{id:"sql-query-api",children:"SQL Query API"}),"\n",(0,a.jsx)(n.h2,{id:"setup",children:"Setup"}),"\n",(0,a.jsx)(n.p,{children:"The first step in working with an SQL table, is to define a table and schema"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:"from superduperdb.backends.ibis import dtype, Table\nfrom superduperdb import Encoder, Schema\n\nmy_enc = Encoder('my-enc')\n\nschema = Schema('my-schema', fields={'img': my_enc, 'text': dtype('str'), 'rating': dtype('int')})\n\ndb = superduper()\n\nt = Table('my-table', schema=schema)\n\ndb.add(t)\n"})}),"\n",(0,a.jsx)(n.h2,{id:"inserting-data",children:"Inserting data"}),"\n",(0,a.jsxs)(n.p,{children:["Table data must correspond to the ",(0,a.jsx)(n.code,{children:"Schema"})," for that table:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:"import pandas\n\npandas.DataFrame([\n    PIL.Image.open('image.jpg'), 'some text', 4,\n    PIL.Image.open('other_image.jpg'), 'some other text', 3,\n])\n\nt.insert(dataframe)\n"})}),"\n",(0,a.jsx)(n.h2,{id:"selecting-data",children:"Selecting data"}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.code,{children:"superduperdb"})," supports selecting data via the ",(0,a.jsx)(n.code,{children:"ibis"})," query API."]}),"\n",(0,a.jsx)(n.p,{children:"The following are equivalent:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:"db.execute(\n    t.filter(t.rating > 3).limit(5).select(t.image)\n)\n"})}),"\n",(0,a.jsx)(n.h3,{id:"vector-search",children:"Vector-search"}),"\n",(0,a.jsxs)(n.p,{children:["Vector-searches are supported via the ",(0,a.jsx)(n.code,{children:"like"})," operator:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:"db.execute(\n    t.like({'text': 'something like this'}, vector_index='my-index')\n     .filter(t.rating > 3)\n     .limit(5)\n     .select(t.image, t.id)\n)\n"})}),"\n",(0,a.jsx)(n.p,{children:"Vector-searches are either first or last in a chain of operations:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:"db.execute(\n    t.filter(t.rating > 3)\n     .limit(5)\n     .select(t.image, t.id)\n     .like({'text': 'something like this'}, vector_index='my-index')\n)\n"})}),"\n",(0,a.jsx)(n.h3,{id:"support-for-raw-sql",children:"Support for raw-sql"}),"\n",(0,a.jsx)(n.p,{children:"... the first query above is equivalent to:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:"db.execute(\n    'SELECT img FROM my-table WHERE rating > 3 LIMIT 5;'\n)\n"})}),"\n",(0,a.jsx)(n.p,{children:"... the second will be equivalent to:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:"db.execute(\n    '''\n    SELECT img FROM my-table \n    LIKE text = 'something like this'\n    WHERE rating > 3\n    LIMIT 5;\n    '''\n)\n"})}),"\n",(0,a.jsx)(n.h2,{id:"updating-data",children:"Updating data"}),"\n",(0,a.jsxs)(n.p,{children:["Updates are not covered for ",(0,a.jsx)(n.code,{children:"superduperdb"})," SQL integrations."]}),"\n",(0,a.jsx)(n.h2,{id:"deleting-data",children:"Deleting data"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:"db.databackend.drop_table('my-table')\n"})})]})}function h(e={}){const{wrapper:n}={...(0,r.a)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(l,{...e})}):l(e)}},11151:(e,n,t)=>{t.d(n,{Z:()=>d,a:()=>s});var a=t(67294);const r={},i=a.createContext(r);function s(e){const n=a.useContext(i);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:s(e.components),a.createElement(i.Provider,{value:n},e.children)}}}]);